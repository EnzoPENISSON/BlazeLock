@page "/coffre/{Id:guid}/logs"
@attribute [Authorize]
@using BlazeLock.DbLib
@using BlazeLock.FRONT.Services
@inject NavigationManager Nav
@inject ILogAPIService LogService

<PageTitle>Logs du Coffre - BlazeLock</PageTitle>

<div class="min-h-screen bg-gray-50 flex flex-col items-center p-6 font-sans">
    <div class="w-full max-w-7xl">
        <div class="flex items-center gap-4 mb-8">
            <button class="bg-white hover:bg-gray-100 text-gray-600 p-3 rounded-xl shadow-sm border border-gray-200 transition-all"
                    @onclick='() => Nav.NavigateTo($"/coffre/{Id}")'>
                <i class="bi bi-arrow-left text-lg"></i>
            </button>
            <div>
                <h1 class="text-3xl font-extrabold text-gray-900">Logs du Coffre</h1>
            </div>
        </div>

        @if (_isLoading)
        {
            <div class="flex justify-center items-center py-20">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"></div>
            </div>
        }
        else if (!_logs.Any())
        {
            <div class="text-center py-20 bg-white rounded-2xl shadow-sm border border-gray-100">
                <i class="bi bi-card-checklist text-5xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-700">Aucun log trouvé</h3>
                <p class="text-gray-500">Il n'y a pas encore d'activité enregistrée pour ce coffre.</p>
            </div>
        }
        else
        {
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        @foreach (var log in _logs)
                        {
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@log.Timestamp.ToString("g")</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@log.Texte</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@log.IdUtilisateur</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public Guid Id { get; set; }

    private List<LogDto> _logs = new();
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var logs = await LogService.GetLogsByVaultIdAsync(Id);
            if (logs != null)
            {
                _logs = logs.OrderByDescending(l => l.Timestamp).ToList();
            }
        }
        catch (Exception ex)
        {
            // Gérer l'erreur, par exemple en affichant un message
            Console.WriteLine($"Error fetching logs: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
        }
    }
}