@page "/coffre/{Id:guid}"
@attribute [Authorize]
@using BlazeLock.DbLib;
@using BlazeLock.FRONT.Services
@using BlazeLock.FRONT.ViewModels
@inject CoffreDetailViewModel ViewModel
@inject NavigationManager Nav

<PageTitle>@ViewModel.VaultName - BlazeLock</PageTitle>

<div class="min-h-screen bg-gray-50 flex flex-col items-center p-6 font-sans">

    @if (!ViewModel.HasAccess)
    {
        <div class="max-w-md w-full bg-white rounded-3xl shadow-xl overflow-hidden mt-10">
            <div class="bg-red-500 p-8 text-center">
                <div class="bg-white/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto backdrop-blur-sm">
                    <i class="bi bi-lock-fill text-4xl text-white"></i>
                </div>
            </div>
            <div class="p-8 text-center">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Accès Refusé</h2>
                <p class="text-gray-500 mb-8">Ce coffre est verrouillé ou votre session a expiré.</p>
                <button class="w-full bg-gray-900 hover:bg-black text-white font-bold py-3 px-6 rounded-xl transition-all duration-200"
                        @onclick='() => Nav.NavigateTo("/")'>
                    Retour à l'accueil
                </button>
            </div>
        </div>
    }
    else
    {
        <div class="w-full max-w-7xl">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                <div class="flex items-center gap-4">
                    <button class="bg-white hover:bg-gray-100 text-gray-600 p-3 rounded-xl shadow-sm border border-gray-200 transition-all"
                            @onclick='() => Nav.NavigateTo("/")'>
                        <i class="bi bi-arrow-left text-lg"></i>
                    </button>
                    <div>
                        <div class="flex items-center gap-3">
                            <h1 class="text-3xl font-extrabold text-gray-900">@ViewModel.VaultName</h1>
                            <span class="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full border border-green-200 flex items-center">
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                                Déchiffré
                            </span>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button class="bg-white hover:bg-gray-50 text-gray-700 font-semibold py-2.5 px-5 rounded-xl border border-gray-200 shadow-sm transition-all flex items-center">
                        <i class="bi bi-gear-fill mr-2 text-gray-400"></i> Paramètres
                    </button>

                    <button @onclick="ViewModel.OpenCreateModal" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-6 rounded-xl shadow-lg hover:shadow-blue-500/30 transition-all flex items-center">
                        <i class="bi bi-plus-lg mr-2"></i> Nouvelle Entrée
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <div class="lg:col-span-1 space-y-4">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
                        <div class="relative mb-4">
                            <i class="bi bi-search absolute left-3 top-3.5 text-gray-400"></i>
                            <input type="text" placeholder="Rechercher..." class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-100 rounded-xl focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition-all text-sm font-medium">
                        </div>
                        <nav class="space-y-1">
                            <a href="#" class="flex items-center justify-between px-4 py-3 bg-blue-50 text-blue-700 rounded-xl font-bold text-sm">
                                <span class="flex items-center"><i class="bi bi-collection mr-3 text-lg"></i> Tous les éléments</span>
                                <span class="bg-blue-200 text-blue-800 text-xs px-2 py-0.5 rounded-md">0</span>
                            </a>
                            <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-xl font-medium text-sm transition-colors">
                                <i class="bi bi-star mr-3 text-lg text-yellow-500"></i> Favoris
                            </a>
                            <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-xl font-medium text-sm transition-colors">
                                <i class="bi bi-trash mr-3 text-lg text-gray-400"></i> Corbeille
                            </a>
                        </nav>
                    </div>
                </div>

                <div class="lg:col-span-3">
                    @if (ViewModel.IsLoading)
                    {
                        <p>Chargement...</p>
                    }
                    else if (ViewModel.Entries.Count == 0)
                    {
                        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 min-h-[400px] flex flex-col items-center justify-center text-center p-8">
                            <div class="bg-gray-50 p-6 rounded-full mb-4">
                                <i class="bi bi-layers text-4xl text-gray-300"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">C'est vide ici !</h3>
                            <p class="text-gray-500 max-w-sm mb-6">Ajoutez votre premier mot de passe.</p>

                            <button @onclick="ViewModel.OpenCreateModal" class="bg-blue-50 hover:bg-blue-100 text-blue-600 font-bold py-3 px-6 rounded-xl transition-colors">
                                Créer une entrée
                            </button>
                        </div>
                    }
                    else
                    {
                        <div class="grid grid-cols-1 gap-4">
                            @foreach (var entry in ViewModel.Entries)
                            {
                                <EntreeCard Entry="@entry" />
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    }
</div>

<CreateEntreeModal IsVisible="@ViewModel.IsCreating"
                   FormModel="@ViewModel.NewEntryForm"
                   IsProcessing="@ViewModel.IsProcessing"
                   ErrorMessage="@ViewModel.ErrorMessage"
                   OnClose="@ViewModel.CloseModal"
                   OnSubmit="@ViewModel.CreateEntryAsync" />

@code {
    [Parameter] public Guid Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await ViewModel.InitializeAsync(Id);
    }
}