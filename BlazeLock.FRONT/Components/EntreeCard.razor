@using BlazeLock.DbLib
@using BlazeLock.FRONT.ViewModels
@inject EntreeDetailViewModel ViewModel

<div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-all cursor-pointer group flex items-center justify-between"
     @onclick="OnClick">

    <div class="flex items-center gap-4">
        @if (!string.IsNullOrEmpty(Entry.LogoUrl))
        {
            <div class="w-12 h-12 rounded-full bg-white border border-gray-100 flex items-center justify-center overflow-hidden">
                <img src="@Entry.LogoUrl"
                     alt="@Entry.Libelle"
                     class="w-full h-full object-contain p-1" />
            </div>
        }
        else
        {
            <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-colors">
                <i class="bi bi-key-fill text-xl"></i>
            </div>
        }

        <div>
            <h4 class="font-bold text-gray-800">@(string.IsNullOrEmpty(Entry.Libelle) ? "Sans titre" : Entry.Libelle)</h4>
            <p class="text-xs text-gray-400">Créé le @Entry.DateCreation.ToShortDateString()</p>
            @if (Entry.DateUpdate != DateTime.MinValue)
            {
                <p class="text-xs text-gray-400">Mis à jour le @Entry.DateUpdate.ToShortDateString()</p>
            }
        </div>
    </div>

    <div class="relative">
        <button class="p-2 text-gray-400 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"
                @onclick:stopPropagation="true"
                @onclick="ToggleMenu">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" />
            </svg>
        </button>

        @if (_isMenuOpen)
        {
            <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-100 z-50 overflow-hidden"
                 @onclick:stopPropagation="true">

                <button class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2 transition-colors"
                        @onclick="OnMoveClick">
                    <i class="bi bi-folder-symlink text-gray-400"></i>
                    Changer de dossier
                </button>

                <button @onclick="DeleteOnclick"  class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2 transition-colors border-t border-gray-50">
                    <i class="bi bi-trash"></i>
                    Supprimer
                </button>
            </div>

            <div class="fixed inset-0 z-40"
                 @onclick="CloseMenu"
                 @onclick:stopPropagation="true">
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public EntreeDto Entry { get; set; }
    [Parameter] public List<DossierDto> Folders { get; set; }

    [Parameter] public EventCallback OnClick { get; set; }

    [Parameter] public EventCallback OnMoveClick { get; set; }
    [Parameter] public EventCallback DeleteOnclick { get; set; }

    private bool _isMenuOpen = false;

    private void ToggleMenu()
    {
        _isMenuOpen = !_isMenuOpen;
    }

    private void CloseMenu()
    {
        _isMenuOpen = false;
    }

}